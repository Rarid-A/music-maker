<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tone.js Music Maker</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Start Overlay -->
    <div id="startOverlay" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.9); z-index: 10000; display: flex; align-items: center; justify-content: center; flex-direction: column; gap: 20px;">
        <h1 style="color: white; font-size: 3em; text-align: center; margin: 0;">üéµ Tone.js Music Maker</h1>
        <p style="color: #ccc; font-size: 1.2em; text-align: center; max-width: 500px; margin: 0;">Click below to start making music!</p>
        <button id="startAudioBtn" style="padding: 20px 50px; font-size: 1.5em; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 50px; cursor: pointer; font-weight: bold; box-shadow: 0 10px 30px rgba(102, 126, 234, 0.5); transition: all 0.3s ease;">
            üéπ Start Music Maker
        </button>
    </div>
    
    <div class="container">
        <header>
            <h1>üéµ Tone.js Music Maker</h1>
            <p class="tagline">Create, loop, and download your music</p>
        </header>

        <nav class="navbar">
            <button id="guideToggle" class="nav-btn">üìñ Guide</button>
            <button id="settingsToggle" class="nav-btn">‚öôÔ∏è Settings</button>
            <a href="https://github.com/Rarid-A/music-maker" target="_blank" class="nav-btn">üîó GitHub</a>
        </nav>

        <!-- Guide Section -->
        <div id="guideSection" class="guide-section hidden">
            <h2>How to Use the Music Maker</h2>
            <div class="guide-content">
                <div class="guide-item">
                    <h3>1. Select Your Instrument</h3>
                    <p>Use the "Instrument" dropdown to choose from various synth types (Sine, Square, Triangle, Sawtooth). Each has a different tone quality.</p>
                </div>
                <div class="guide-item">
                    <h3>2. Set the Tempo</h3>
                    <p>Adjust the BPM (Beats Per Minute) using the tempo slider. Default is 120 BPM. Higher BPM = faster music.</p>
                </div>
                <div class="guide-item">
                    <h3>3. Create Your Melody</h3>
                    <p>Click on the piano keys or use your keyboard to play notes. The keyboard mapping is shown in the settings.</p>
                </div>
                <div class="guide-item">
                    <h3>4. Set Loop Duration</h3>
                    <p>Define how many beats your loop should contain (4, 8, 16, 32, or 64 beats). The download will capture exactly one loop.</p>
                </div>
                <div class="guide-item">
                    <h3>5. Adjust Sound Properties</h3>
                    <p>Use Attack to control how quickly the sound starts, and Release to control how long it sustains after you release a note.</p>
                </div>
                <div class="guide-item">
                    <h3>6. Record and Download</h3>
                    <p>Press "Start Recording" to begin capturing your performance. The recording will automatically stop after your loop duration. Then "Download Audio" to save your music!</p>
                </div>
            </div>
        </div>

        <!-- Settings Section -->
        <div id="settingsSection" class="settings-section hidden">
            <h2>Settings & Help</h2>
            <div class="settings-content">
                <div class="setting-group">
                    <h3>Keyboard Mapping</h3>
                    <p><strong>White Keys (C-B):</strong> A, S, D, F, G, H, J, K keys</p>
                    <p><strong>Black Keys (C#-B#):</strong> W, E, T, Y, U keys</p>
                    <p>Example: Press 'A' for C4, 'W' for C#4, 'S' for D4, etc.</p>
                </div>
                <div class="setting-group">
                    <h3>Tips & Tricks</h3>
                    <ul>
                        <li>üéß Use headphones for better sound quality</li>
                        <li>‚è±Ô∏è Adjust attack for punchy or smooth sounds</li>
                        <li>üéöÔ∏è Use release to create sustain effects</li>
                        <li>üîä Lower the volume if the output is too loud</li>
                        <li>üîÑ Set an appropriate loop duration before recording</li>
                        <li>üíæ Downloaded audio will contain exactly one loop</li>
                    </ul>
                </div>
                <div class="setting-group">
                    <h3>About</h3>
                    <p>This web app is built with <strong>Tone.js</strong>, a JavaScript Web Audio API library.</p>
                    <p>It records your audio performance and saves it as a WebM audio file for easy playback and sharing.</p>
                </div>
            </div>
        </div>

        <!-- Main Controls -->
        <div class="controls-section">
            <div class="control-group">
                <label for="instrumentSelect">Instrument:</label>
                <select id="instrumentSelect">
                    <option value="sine">Sine Wave</option>
                    <option value="square">Square Wave</option>
                    <option value="triangle">Triangle Wave</option>
                    <option value="sawtooth">Sawtooth Wave</option>
                </select>
            </div>

            <div class="control-group">
                <label for="tempoSlider">Tempo (BPM):</label>
                <div class="slider-container">
                    <input type="range" id="tempoSlider" min="40" max="200" value="120" step="1">
                    <span id="tempoDisplay">120</span>
                </div>
            </div>

            <div class="control-group">
                <label for="volumeSlider">Master Volume:</label>
                <div class="slider-container">
                    <input type="range" id="volumeSlider" min="0" max="1" value="0.5" step="0.01">
                    <span id="volumeDisplay">50%</span>
                </div>
            </div>

            <div class="control-group">
                <label for="loopBeatsSelect">Loop Duration (Beats):</label>
                <select id="loopBeatsSelect">
                    <option value="4">4 Beats (1 Bar)</option>
                    <option value="8">8 Beats (2 Bars)</option>
                    <option value="16">16 Beats (4 Bars)</option>
                    <option value="32">32 Beats (8 Bars)</option>
                    <option value="64">64 Beats (16 Bars)</option>
                </select>
            </div>

            <div class="control-group">
                <label for="attackSlider">Attack (ms):</label>
                <div class="slider-container">
                    <input type="range" id="attackSlider" min="0" max="500" value="10" step="10">
                    <span id="attackDisplay">10</span>
                </div>
            </div>

            <div class="control-group">
                <label for="decaySlider">Release (ms):</label>
                <div class="slider-container">
                    <input type="range" id="decaySlider" min="0" max="1000" value="200" step="10">
                    <span id="decayDisplay">200</span>
                </div>
            </div>
        </div>

        <!-- Piano Section -->
        <div class="piano-section">
            <h2>Piano Keyboard</h2>
            <p style="text-align: center; color: #666; margin-bottom: 15px;">Click keys or use your keyboard (A-L for white keys, W,E,T,Y,U for black keys)</p>
            <div class="piano">
                <div class="octave">
                    <div class="white-key" data-note="C4">C</div>
                    <div class="black-key" data-note="C#4">C#</div>
                    <div class="white-key" data-note="D4">D</div>
                    <div class="black-key" data-note="D#4">D#</div>
                    <div class="white-key" data-note="E4">E</div>
                    <div class="white-key" data-note="F4">F</div>
                    <div class="black-key" data-note="F#4">F#</div>
                    <div class="white-key" data-note="G4">G</div>
                    <div class="black-key" data-note="G#4">G#</div>
                    <div class="white-key" data-note="A4">A</div>
                    <div class="black-key" data-note="A#4">A#</div>
                    <div class="white-key" data-note="B4">B</div>
                    <div class="white-key" data-note="C5">C</div>
                </div>
            </div>
        </div>

        <!-- Recording Section -->
        <div class="recording-section">
            <h2>Recording & Export</h2>
            <div class="button-group">
                <button id="startRecordBtn" class="btn btn-primary">‚ñ∂Ô∏è Start Recording</button>
                <button id="stopRecordBtn" class="btn btn-secondary" disabled>‚èπÔ∏è Stop Recording</button>
                <button id="downloadBtn" class="btn btn-success" disabled>üíæ Download Audio</button>
                <button id="clearBtn" class="btn btn-danger">üóëÔ∏è Clear</button>
            </div>
            <div id="recordingStatus" class="status-message"></div>
        </div>

        <footer>
            <p>&copy; 2025 Tone.js Music Maker. Built with ‚ù§Ô∏è using <a href="https://tonejs.org" target="_blank">Tone.js</a></p>
        </footer>
    </div>

    <!-- Tone.js Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>
    
    <!-- Application Script -->
    <script src="app.js"></script>
</body>
</html>
